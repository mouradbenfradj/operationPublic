{% extends 'base.html.twig' %}

{% block title %}
  Suivit index
{% endblock %}

{% block body %}
  <!-- Page Header Start -->
  <div class="page-header">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h2>متابعة تنفيذ الصفقات العمومية</h2>
        </div>
       
        <div class="col-12">
          <a href="">الاستقبال</a>
          <a href="">متابعة تنفيذ الصفقات العمومية</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Page Header End -->

  <!-- Single Post Start -->
  <div class="single">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="comment-form wow fadeInUp">
            <h2>متابعة تنفيذ الصفقات العمومية</h2>
            {% if suivits is not defined %}
              {{ form_start(form) }}
              {# <form> #}
              <div class="form-group">
                {{ form_row(form.nature) }}
                {# <label for="name">Name *</label>
                <input type="text" class="form-control" id="name" /> #}
              </div>
              <div class="form-group">
                {{ form_row(form.sujet) }}
                {#  <label for="email">Email *</label>
                <input type="email" class="form-control" id="email" /> #}
              </div>
              <div class="form-group">
                              {{ form_row(form.satisfaction) }}
  {# <label for="website">Website</label>
                <input type="url" class="form-control" id="website" /> #}
              </div>

              <div class="form-group">
                               {{ form_row(form.defauts) }}
 {#   <label for="message">Message *</label>
                <textarea id="message" cols="30" rows="5" class="form-control"></textarea> #}
              </div>
              <div class="form-group">
                               {{ form_row(form.risques) }}
 {#   <label for="message">Message *</label>
                <textarea id="message" cols="30" rows="5" class="form-control"></textarea> #}
              </div>
              <div class="form-group">
                <input type="submit" value="Filtrer" class="btn" />
              </div>
              {{ form_end(form) }}

              {# </form> #}
            {% else %}
              <table class="table">
                <thead>
                  <tr>
                    <th>Id</th>
                    <th>Nature</th>
                    <th>Sujet</th>
                    <th>Cout</th>
                    <th>Proprietaire</th>
                    <th>Debut</th>
                    <th>Fin</th>
                    <th>JourDeRetard</th>
                    <th>CauseRetard</th>
                    <th>DateCauseResiliation</th>
                    <th>DateValidationFinal</th>
                    <th>actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for suivit in suivits %}
                    <tr>
                      <td>{{ suivit.id }}</td>
                      <td>{{ suivit.nature }}</td>
                      <td>{{ suivit.sujet }}</td>
                      <td>{{ suivit.cout }}</td>
                      <td>{{ suivit.proprietaire }}</td>
                      <td>{{ suivit.debut ? suivit.debut|date('Y-m-d') : '' }}</td>
                      <td>{{ suivit.fin ? suivit.fin|date('Y-m-d') : '' }}</td>
                      <td>{{ suivit.jourDeRetard }}</td>
                      <td>{{ suivit.causeRetard }}</td>
                      <td>{{ suivit.dateCauseResiliation }}</td>
                      <td>{{ suivit.dateValidationFinal ? suivit.dateValidationFinal|date('Y-m-d') : '' }}</td>
                      <td>
                        <a href="{{ path('app_suivit_show', { id: suivit.id }) }}">show</a>
                        <a href="{{ path('app_suivit_edit', { id: suivit.id }) }}">edit</a>
                      </td>
                    </tr>
                  {% else %}
                    <tr>
                      <td colspan="12">no records found</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Single Post End -->
{% endblock %}

{% block javascripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var natureFields = document.querySelectorAll('input[name="suivit_filter[nature]"]')
      var sujetField = document.getElementById('{{ form.sujet.vars.id }}')
    
      natureFields.forEach(function (natureField) {
        natureField.addEventListener('click', function () {
          var natureId = natureField.value
          fetch('/suivit/get-sujets?natureId=' + natureId)
            .then((response) => response.json())
            .then((data) => {
              sujetField.innerHTML = '' // Efface les options précédentes
              data.forEach(function (sujetData) {
                var option = document.createElement('option')
                option.value = sujetData.sujet // Utilisez le nom du sujet comme valeur
                option.textContent = sujetData.sujet // Affichez le nom du sujet
                sujetField.appendChild(option)
              })
            })
        })
      })
    })
  </script>
{% endblock %}